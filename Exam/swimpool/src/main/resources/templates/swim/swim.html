<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>수영장 관리</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .modal-header {
            background-color: #0d6efd;
            color: white;
        }
        .modal-title {
            font-weight: bold;
        }
        .form-label {
            font-weight: 500;
        }
    </style>
</head>
<body class="container py-4">
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">수영장 목록</h2>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStaticBackdrop">
        + 수영장 추가
    </button>
</div>

<div id="listData" class="row gy-3"></div>

<!-- 등록 모달 -->
<div class="modal fade" id="addStaticBackdrop" data-bs-backdrop="static" tabindex="-1" aria-labelledby="addStaticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addStaticBackdropLabel">수영장 등록</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="addName" class="form-label">수영장 이름</label>
                    <input type="text" class="form-control" id="addName">
                </div>
                <div class="mb-3">
                    <label for="addLanes" class="form-label">라인 수</label>
                    <input type="number" class="form-control" id="addLanes">
                </div>
                <div class="mb-3">
                    <label for="addLaneType" class="form-label">라인 길이</label>
                    <select id="addLaneType" class="form-select">
                        <option value="25">25M</option>
                        <option value="50">50M</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="addPhoneNumber" class="form-label">전화번호</label>
                    <input type="text" class="form-control" id="addPhoneNumber">
                </div>
                <div class="mb-3">
                    <label for="addAddr" class="form-label">주소</label>
                    <input type="text" class="form-control" id="addAddr">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="$.add()">등록</button>
                <button class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            </div>
        </div>
    </div>
</div>

<!-- 상세보기/수정 모달 -->
<div class="modal fade" id="updateStaticBackdrop" data-bs-backdrop="static" tabindex="-1" aria-labelledby="updateStaticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateStaticBackdropLabel">수영장 상세정보</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="viewId">
                <div class="mb-3">
                    <label for="viewName" class="form-label">수영장 이름</label>
                    <input type="text" class="form-control" id="viewName">
                </div>
                <div class="mb-3">
                    <label for="viewLanes" class="form-label">라인 수</label>
                    <input type="number" class="form-control" id="viewLanes">
                </div>
                <div class="mb-3">
                    <label for="viewLaneType" class="form-label">라인 길이</label>
                    <select id="viewLaneType" class="form-select">
                        <option value="25">25M</option>
                        <option value="50">50M</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="viewPhoneNumber" class="form-label">전화번호</label>
                    <input type="text" class="form-control" id="viewPhoneNumber">
                </div>
                <div class="mb-3">
                    <label for="viewAddr" class="form-label">주소</label>
                    <input type="text" class="form-control" id="viewAddr">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="$.dataUpdate()">수정</button>
                <button class="btn btn-danger" onclick="$.dataDelete()">삭제</button>
                <button class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>

<!-- jQuery 스크립트 -->
<script>
    $(document).ready(function () {
        $.dataList();
    });

    $.add = function () {
        let addData = {
            "name": $("#addName").val(),
            "lanes": $("#addLanes").val(),
            "laneType": $("#addLaneType").val(),
            "phoneNumber": $("#addPhoneNumber").val(),
            "addr": $("#addAddr").val()
        };
        $.ajax({
            url: 'swim/insert',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(addData),
            method: 'POST'
        }).done(function () {
            $.dataList();
            bootstrap.Modal.getInstance(document.getElementById('addStaticBackdrop')).hide();
            $.cleanModal();
        }).fail(function (jqXHR, status, error) {
            console.log("Error", status, error);
        });
    };

    $.dataList = function () {
        $.ajax({
            url: '/swim/list',
            dataType: 'json',
            method: 'GET'
        }).done(function (data) {
            $.printList(data.responseData);
        }).fail(function (jqXHR, status, error) {
            console.log("ERROR : ", status, error);
        });
    };

    $.dataOne = function (id) {
        $.ajax({
            url: '/swim/' + id,
            method: 'GET'
        }).done(function (data) {
            $.printOne(data.responseData);
        }).fail(function (jqXHR, status, error) {
            console.log("ERROR : ", status, error);
        });
    };

    $.dataUpdate = function () {
        let jsonUpdate = {
            "id": Number($("#viewId").val()),
            "name": $("#viewName").val(),
            "lanes": Number($("#viewLanes").val()),
            "laneType": $("#viewLaneType").val(),
            "phoneNumber": $("#viewPhoneNumber").val(),
            "addr": $("#viewAddr").val()
        };
        $.ajax({
            url: '/swim/' + jsonUpdate.id,
            dataType: 'json',
            data: JSON.stringify(jsonUpdate),
            method: 'PATCH',
            contentType: 'application/json'
        }).done(function () {
            $.dataList();
            bootstrap.Modal.getInstance(document.getElementById('updateStaticBackdrop')).hide();
        }).fail(function (jqXHR, status, error) {
            console.log("Error", status, error);
        });
    };

    $.dataDelete = function () {
        let deleteData = { "id": Number($("#viewId").val()) };
        $.ajax({
            url: 'swim/' + deleteData.id,
            method: 'DELETE',
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify(deleteData)
        }).done(function () {
            bootstrap.Modal.getInstance(document.getElementById('updateStaticBackdrop')).hide();
            $.dataList();
        }).fail(function (jqXHR, status, error) {
            console.log("Error", status, error);
        });
    };

    $.printList = function (data) {
        $("#listData").empty();
        for (let item of data) {
            let html = `
                <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm" onclick="$.dataOne(${item.id})" style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#updateStaticBackdrop">
                        <div class="card-body">
                            <h5 class="card-title">${item.name}</h5>
                            <p class="card-text">
                                <strong>라인 수:</strong> ${item.lanes}개<br>
                                <strong>라인 길이:</strong> ${item.laneType}M<br>
                                <strong>전화번호:</strong> ${item.phoneNumber}<br>
                                <strong>주소:</strong> ${item.addr}
                            </p>
                        </div>
                    </div>
                </div>`;
            $("#listData").append(html);
        }
    };

    $.printOne = function (item) {
        if (!item) return;
        $("#viewId").val(item.id);
        $("#viewName").val(item.name);
        $("#viewLanes").val(item.lanes);
        $("#viewLaneType").val(item.laneType);
        $("#viewPhoneNumber").val(item.phoneNumber);
        $("#viewAddr").val(item.addr);
    };

    $.cleanModal = function () {
        $("#addName").val("");
        $("#addLanes").val("");
        $("#addLaneType").val("25");
        $("#addPhoneNumber").val("");
        $("#addAddr").val("");
    };
</script>
</body>
</html>
